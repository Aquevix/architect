var Haml;(function(){function html_escape(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;")}function render_attribs(a){var b,c,d=[];for(b in a)if(b!=="_content"&&a.hasOwnProperty(b))switch(a[b]){case"undefined":case"false":case"null":case'""':break;default:try{c=JSON.parse("["+a[b]+"]")[0],c===!0?c=b:typeof c=="string"&&embedder.test(c)?c='" +\n'+parse_interpol(html_escape(c))+' +\n"':c=html_escape(c),d.push(" "+b+'=\\"'+c+'\\"')}catch(e){d.push(" "+b+'=\\"" + '+escaperName+"("+a[b]+') + "\\"')}}return d.join("")}function parse_attribs(a){function n(){if(typeof m.start=="number"&&typeof m.middle=="number"&&typeof m.end=="number"){var c=a.substr(m.start,m.middle-m.start).trim(),d=a.substr(m.middle+1,m.end-m.middle-1).trim();b[c]=d}m={start:null,middle:null,end:null}}var b={},c=a.length,d,e,f=1,g=!1,h=!1,i,j,k,l,m={start:1,middle:null,end:null};if(c>0&&(a.charAt(0)==="{"||a.charAt(0)==="(")){i=a.charAt(0),j=i==="{"?"}":")",k=i==="{"?":":"=",l=i==="{"?",":" ";for(d=1;f>0;d+=1){if(d>c)throw"Malformed attribute block";e=a.charAt(d);if(h)h=!1;else if(g)e==="\\"&&(h=!0),e===g&&(g=!1);else{if(e==='"'||e==="'")g=e;if(f===1){e===k&&(m.middle=d);if(e===l||e===j)m.end=d,n(),e===l&&(m.start=d+1)}if(e===i||e==="(")f+=1;if(e===j||f>1&&e===")")f-=1}}return b._content=a.substr(d,a.length),b}return{_content:a[0]===" "?a.substr(1,c):a}}function parse_interpol(a){var b=[],c=0,d=0,e;for(;;){d=a.substr(c).search(embedder);if(d<0){c<a.length&&b.push(JSON.stringify(a.substr(c)));break}b.push(JSON.stringify(a.substr(c,d))),c+=d,e=a.substr(c).match(embedder),d=e[0].length;if(d<0)break;e[1]==="#"?b.push(escaperName+"("+(e[2]||e[3])+")"):b.push(e[2]||e[3]),c+=d}return b.filter(function(a){return a&&a.length>0}).join(" +\n")}function compile(a){var b=!1,c=[];typeof a=="string"&&(a=a.trim().replace(/\n\r|\r/g,"\n").split("\n")),a.forEach(function(a){var d,e=!1;if(b){d=b.check_indent.exec(a);if(d){b.contents.push(d[1]||"");return}c.push(b.process()),b=!1}matchers.forEach(function(c){e||(d=c.regexp.exec(a),d&&(b={contents:[],indent_level:d[1],matches:d,check_indent:new RegExp("^(?:\\s*|"+d[1]+"  (.*))$"),process:c.process,render_contents:function(){return compile(this.contents)}},e=!0))}),e||c.push(function(){function b(){try{return escaperName+"("+JSON.stringify(JSON.parse(a))+")"}catch(b){return escaperName+"("+a+")"}}function c(){try{return parse_interpol(JSON.parse(a))}catch(b){return a}}return a[0]==="\\"?parse_interpol(a.substr(1,a.length)):a.substr(0,2)==="&="?(a=a.substr(2,a.length).trim(),b()):a.substr(0,2)==="!="?(a=a.substr(2,a.length).trim(),c()):a[0]==="="?(a=a.substr(1,a.length).trim(),escapeHtmlByDefault?b():c()):parse_interpol(a)}())}),b&&c.push(b.process());var d=c.filter(function(a){return a&&a.length>0}).join(" +\n");return d.length==0&&(d='""'),d}function optimize(a){function f(){c.length>0&&(b.push(JSON.stringify(c.join(""))+e),c=[])}var b=[],c=[],d,e;return a.replace(/\n\r|\r/g,"\n").split("\n").forEach(function(a){d=a.match(/^(\".*\")(\s*\+\s*)?$/);if(!d){f(),b.push(a);return}e=d[2]||"",d=d[1];try{c.push(JSON.parse(d))}catch(g){f(),b.push(a)}}),f(),b.join("\n")}function render(a,b){b=b||{},a=a||"";var c=compile(a,b);return b.optimize&&(c=Haml.optimize(c)),execute(c,b.context||Haml,b.locals)}function execute(js,self,locals){return function(){with(locals||{})try{var _$output;return eval("_$output ="+js),_$output}catch(e){return"\n<pre class='error'>"+html_escape(e.stack)+"</pre>\n"}}.call(self)}var matchers,self_close_tags,embedder,forceXML,escaperName,escapeHtmlByDefault;embedder=/([#!])\{([^}]*)\}/,self_close_tags=["meta","img","link","br","hr","input","area","base"],matchers=[{name:"html tags",regexp:/^(\s*)((?:[.#%][a-z_\-][a-z0-9_:\-]*)+)(.*)$/i,process:function(){var a,b,c,d,e,f,g,h={},i;a=this.matches[2],c=a.match(/\.([a-z_\-][a-z0-9_\-]*)/gi),d=a.match(/\#([a-z_\-][a-z0-9_\-]*)/gi),b=a.match(/\%([a-z_\-][a-z0-9_:\-]*)/gi),b=b?b[0].substr(1,b[0].length):"div",e=this.matches[3];if(e){e=parse_attribs(e);if(e._content){var j=e._content.charAt(0),k=e._content.charAt(1),l=0;j=="<"?(l++,h.inside=!0,k==">"&&(l++,h.around=!0)):j==">"&&(l++,h.around=!0,k=="<"&&(l++,h.inside=!0)),e._content=e._content.substr(l),this.contents.unshift(e._content.trim()),delete e._content}}else e={};if(c){c=c.map(function(a){return a.substr(1,a.length)}).join(" ");if(e["class"])try{e["class"]=JSON.stringify(c+" "+JSON.parse(e["class"]))}catch(m){e["class"]=JSON.stringify(c+" ")+" + "+e["class"]}else e["class"]=JSON.stringify(c)}d&&(d=d.map(function(a){return a.substr(1,a.length)}).join(" "),e.id?e.id=JSON.stringify(d+" ")+e.id:e.id=JSON.stringify(d)),e=render_attribs(e),f=this.render_contents(),f==='""'&&(f="");if(h.inside)if(f.length==0)f='"  "';else try{f='" '+JSON.parse(f)+' "'}catch(m){f='" "+\n'+f+'+\n" "'}return(forceXML?f.length>0:self_close_tags.indexOf(b)==-1)?i='"<'+b+e+'>"'+(f.length>0?" + \n"+f:"")+' + \n"</'+b+'>"':i='"<'+b+e+' />"',h.around&&(i='" '+i.substr(1,i.length-2)+' "'),i}},{name:"each loop",regexp:/^(\s*)(?::for|:each)\s+(?:([a-z_][a-z_\-]*),\s*)?([a-z_][a-z_\-]*)\s+in\s+(.*)(\s*)$/i,process:function(){var a=this.matches[2]||"__key__",b=this.matches[3],c=this.matches[4],d="__result__";return this.matches[5]&&this.contents.unshift(this.matches[5]),"(function () { var "+d+" = [], "+a+", "+b+"; "+"for ("+a+" in "+c+") { "+"if ("+c+".hasOwnProperty("+a+")) { "+b+" = "+c+"["+a+"]; "+d+".push(\n"+(this.render_contents()||"''")+"\n); "+"} } return "+d+'.join(""); }).call(this)'}},{name:"if",regexp:/^(\s*):if\s+(.*)\s*$/i,process:function(){var a=this.matches[2];return"(function () { if ("+a+") { "+"return (\n"+(this.render_contents()||"")+"\n);"+'} else { return ""; } }).call(this)'}},{name:"silent-comments",regexp:/^(\s*)-#\s*(.*)\s*$/i,process:function(){return'""'}},{name:"silent-comments",regexp:/^(\s*)\/\s*(.*)\s*$/i,process:function(){return this.contents.unshift(this.matches[2]),'"<!--'+this.contents.join("\\n")+'-->"'}},{name:"rawjs",regexp:/^(\s*)-\s*(.*)\s*$/i,process:function(){return this.contents.unshift(this.matches[2]),'"";'+this.contents.join("\n")+"; _$output = _$output "}},{name:"pre",regexp:/^(\s*):pre(\s+(.*)|$)/i,process:function(){return this.contents.unshift(this.matches[2]),'"<pre>"+\n'+JSON.stringify(this.contents.join("\n"))+'+\n"</pre>"'}},{name:"doctype",regexp:/^()!!!(?:\s*(.*))\s*$/,process:function(){var a="";switch((this.matches[2]||"").toLowerCase()){case"":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">';break;case"strict":case"1.0":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">';break;case"frameset":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">';break;case"5":a="<!DOCTYPE html>";break;case"1.1":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">';break;case"basic":a='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">';break;case"mobile":a='<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">';break;case"xml":a="<?xml version='1.0' encoding='utf-8' ?>";break;case"xml iso-8859-1":a="<?xml version='1.0' encoding='iso-8859-1' ?>"}return JSON.stringify(a+"\n")}},{name:"markdown",regexp:/^(\s*):markdown\s*$/i,process:function(){return parse_interpol(exports.Markdown.encode(this.contents.join("\n")))}},{name:"script",regexp:/^(\s*):(?:java)?script\s*$/,process:function(){return parse_interpol('\n<script type="text/javascript">\n//<![CDATA[\n'+this.contents.join("\n")+"\n//]]>\n</script>\n")}},{name:"css",regexp:/^(\s*):css\s*$/,process:function(){return JSON.stringify('<style type="text/css">\n'+this.contents.join("\n")+"\n</style>")}}],Haml=function(b,c){typeof c!="object"&&(forceXML=c,c={});var d;c.customEscape?(d="",escaperName=c.customEscape):(d=html_escape.toString()+"\n",escaperName="html_escape"),escapeHtmlByDefault=c.escapeHtmlByDefault||c.escapeHTML||c.escape_html;var e=optimize(compile(b)),f="with(locals || {}) {\n  try {\n   var _$output="+e+";\n return _$output;"+"  } catch (e) {\n"+"    return \"\\n<pre class='error'>\" + "+escaperName+'(e.stack) + "</pre>\\n";\n'+"  }\n"+"}";try{var g=new Function("locals",d+f);return g}catch(h){throw console.error(f),h}},Haml.compile=compile,Haml.optimize=optimize,Haml.render=render,Haml.execute=execute,Haml.html_escape=html_escape})(),typeof module!="undefined"&&(module.exports=Haml)
