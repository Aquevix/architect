!function(t,e){if("object"==typeof exports&&exports)e(exports)
else{var n={}
e(n),"function"==typeof define&&define.amd?define(n):t.Mustache=n}}(this,function(t){function e(t,e){return w.call(t,e)}function n(t){return!e(d,t)}function r(t){return"function"==typeof t}function s(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(t){return(t+"").replace(/[&<>"'\/]/g,function(t){return U[t]})}function o(t){if(!x(t)||2!==t.length)throw Error("Invalid tags: "+t)
return[RegExp(s(t[0])+"\\s*"),RegExp("\\s*"+s(t[1]))]}function a(e,r){function i(){if(j&&!C)for(;T.length;)delete E[T.pop()]
else T=[]
j=!1,C=!1}r=r||t.tags,e=e||"","string"==typeof r&&(r=r.split(g))
for(var a,l,p,d,w,b,x=o(r),U=new h(e),m=[],E=[],T=[],j=!1,C=!1;!U.eos();){if(a=U.pos,p=U.scanUntil(x[0]))for(var A=0,R=p.length;R>A;++A)d=p.charAt(A),n(d)?T.push(E.length):C=!0,E.push(["text",d,a,a+1]),a+=1,"\n"===d&&i()
if(!U.scan(x[0]))break
if(j=!0,l=U.scan(y)||"name",U.scan(f),"="===l?(p=U.scanUntil(v),U.scan(v),U.scanUntil(x[1])):"{"===l?(p=U.scanUntil(RegExp("\\s*"+s("}"+r[1]))),U.scan(k),U.scanUntil(x[1]),l="&"):p=U.scanUntil(x[1]),!U.scan(x[1]))throw Error("Unclosed tag at "+U.pos)
if(w=[l,p,a,U.pos],E.push(w),"#"===l||"^"===l)m.push(w)
else if("/"===l){if(b=m.pop(),!b)throw Error('Unopened section "'+p+'" at '+a)
if(b[1]!==p)throw Error('Unclosed section "'+b[1]+'" at '+a)}else"name"===l||"{"===l||"&"===l?C=!0:"="===l&&(x=o(r=p.split(g)))}if(b=m.pop())throw Error('Unclosed section "'+b[1]+'" at '+U.pos)
return u(c(E))}function c(t){for(var e,n,r=[],s=0,i=t.length;i>s;++s)e=t[s],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(r.push(e),n=e))
return r}function u(t){for(var e,n,r=[],s=r,i=[],o=0,a=t.length;a>o;++o)switch(e=t[o],e[0]){case"#":case"^":s.push(e),i.push(e),s=e[4]=[]
break
case"/":n=i.pop(),n[5]=e[2],s=i.length>0?i[i.length-1][4]:r
break
default:s.push(e)}return r}function h(t){this.string=t,this.tail=t,this.pos=0}function l(t,e){this.view=null==t?{}:t,this.cache={".":this.view},this.parent=e}function p(){this.cache={}}var f=/\s*/,g=/\s+/,d=/\S/,v=/\s*=/,k=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/,w=RegExp.prototype.test,b=Object.prototype.toString,x=Array.isArray||function(t){return"[object Array]"===b.call(t)},U={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}
h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(t){var e=this.tail.match(t)
if(e&&0===e.index){var n=e[0]
return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},h.prototype.scanUntil=function(t){var e,n=this.tail.search(t)
switch(n){case-1:e=this.tail,this.tail=""
break
case 0:e=""
break
default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},l.prototype.push=function(t){return new l(t,this)},l.prototype.lookup=function(t){var e
if(t in this.cache)e=this.cache[t]
else{for(var n=this;n;){if(t.indexOf(".")>0){e=n.view
for(var s=t.split("."),i=0;null!=e&&i<s.length;)e=e[s[i++]]}else e=n.view[t]
if(null!=e)break
n=n.parent}this.cache[t]=e}return r(e)&&(e=e.call(this.view)),e},p.prototype.clearCache=function(){this.cache={}},p.prototype.parse=function(t,e){var n=this.cache,r=n[t]
return null==r&&(r=n[t]=a(t,e)),r},p.prototype.render=function(t,e,n){var r=this.parse(t),s=e instanceof l?e:new l(e)
return this.renderTokens(r,s,n,t)},p.prototype.renderTokens=function(e,n,s,i){function o(t){return h.render(t,n,s)}for(var a,c,u="",h=this,l=0,p=e.length;p>l;++l)switch(a=e[l],a[0]){case"#":if(c=n.lookup(a[1]),!c)continue
if(x(c))for(var f=0,g=c.length;g>f;++f)u+=this.renderTokens(a[4],n.push(c[f]),s,i)
else if("object"==typeof c||"string"==typeof c)u+=this.renderTokens(a[4],n.push(c),s,i)
else if(r(c)){if("string"!=typeof i)throw Error("Cannot use higher-order sections without the original template")
c=c.call(n.view,i.slice(a[3],a[5]),o),null!=c&&(u+=c)}else u+=this.renderTokens(a[4],n,s,i)
break
case"^":c=n.lookup(a[1]),(!c||x(c)&&0===c.length)&&(u+=this.renderTokens(a[4],n,s,i))
break
case">":if(!s)continue
c=r(s)?s(a[1]):s[a[1]],null!=c&&(u+=this.renderTokens(this.parse(c),n,s,c))
break
case"&":c=n.lookup(a[1]),null!=c&&(u+=c)
break
case"name":c=n.lookup(a[1]),null!=c&&(u+=t.escape(c))
break
case"text":u+=a[1]}return u},t.name="mustache.js",t.version="0.8.1",t.tags=["{{","}}"]
var m=new p
t.clearCache=function(){return m.clearCache()},t.parse=function(t,e){return m.parse(t,e)},t.render=function(t,e,n){return m.render(t,e,n)},t.to_html=function(e,n,s,i){var o=t.render(e,n,s)
return r(i)?(i(o),void 0):o},t.escape=i,t.Scanner=h,t.Context=l,t.Writer=p})
